{"mappings":"2MAAA,IAAAA,EAAAC,EAAA,S,WAGA,MAAMC,EAAW,IAAI,EAAAF,EAAAG,UACfC,EAAmB,QACnBC,EAAaC,SAASC,cAAc,OACpCC,EAAaF,SAASG,cAAc,iBAC1C,IAAIC,EAAgB,GAChBC,EAAS,KAoGb,SAASC,EAAQC,GACVA,EAAIC,SAGPR,SAASS,KAAKC,YAAYX,GAC1BC,SAASW,oBAAoB,QAASC,G,CAvG1CV,EAAWW,iBAAiB,SAE5BC,eAAuBC,GAErB,IADkBA,EAAEP,OAAOQ,cACZC,UAAUC,SAAS,WAChC,OAGFb,EAASU,EAAEP,OAAOQ,cAAcG,QAAQC,GACxC,IAAIC,EAAQC,EAAmBjB,GAC3B,gCACA,uBACJkB,QAAQC,IAAIH,GAEZ,IAEE,MACMI,SADiB7B,EAAS8B,SAASrB,IACjBsB,KAGxB5B,EAAW6B,UAsBf,UAAyBC,OACvBA,EAAMC,WACNA,EAAUC,MACVA,EAAKC,UACLA,EAASC,UACTA,EAASC,YACTA,IAEA,MAAO,2ZAUmCJ,WAAoBC,uEAGlDA,uBACAF,sBACDK,gDAcb,SAAyBC,GACvB,MAAMC,EAAgBD,EAASE,QAC7B,EAACC,KAAEA,KACQ,WAATA,GAA8B,gBAATA,GAAmC,aAATA,IAYnD,OAToBF,EACjBG,KACC,EAACD,KAAEA,EAAIE,IAAEA,KAAU,oCACEA,gGACYF,iDAIlCG,KAAK,G,CA3B8BC,CAAgBV,0O,CA9C7BW,CAAgBlB,GACvCzB,SAASS,KAAKmC,YAAY7C,GAG1B,MAAM8C,EAAa9C,EAAWI,cAAc,mBAC5CoB,QAAQuB,IAAID,GAEZA,EAAWhC,iBAAiB,SAASN,KAiFzC,SAA+BwC,GAC7B,GAAIzB,EAAmByB,GAErB,YAQJ,SAAmCC,GACjC,IAAIC,EAAMC,KAAKC,MAAMC,aAAaC,QAAQvD,IAC1CmD,EAAMA,EAAIZ,QAAOiB,GAAQA,IAASN,IAClCI,aAAaG,QAAQzD,EAAkBoD,KAAKM,UAAUP,G,CAZpDQ,CAA0BV,GAG5B3C,EAAcsD,KAAKX,GACnBK,aAAaG,QAAQzD,EAAkBoD,KAAKM,UAAUpD,IACtDmB,QAAQC,IAAIpB,E,CAvFRuD,CAAsBtD,EAAO,IAMTN,EAAWI,cAAc,mBACjCU,iBAAiB,QAASP,E,CACxC,MAAOsD,GACPrC,QAAQC,IAAIoC,E,KAyFhB,MAAMhD,EAAWL,IACC,WAAZA,EAAIsD,MACN7D,SAASS,KAAKC,YAAYX,GAC1BC,SAASW,oBAAoB,QAASC,G,EAK1C,SAASU,EAAmBwC,GAE1B,OADA1D,EAAgB8C,KAAKC,MAAMC,aAAaC,QAAQvD,KAAsB,KACjEM,EAAc2D,SAASD,E,CAJ9B9D,SAASa,iBAAiB,UAAWD,E,yKC9IrC,IAAAoD,EAAArE,EAAA,SAEO,MAAMsE,EACXC,GAAY,6CAEZpD,eAAeqD,GACb,MAAM3B,EAAM,GAAG4B,MAAKF,IAAYC,IAGhC,aADqBH,EAAAK,QAAMC,IAAI9B,E","sources":["src/js/popup/popupModal.js","src/js/api/fetchBooks.js"],"sourcesContent":["import { AxiosApi } from '../api/fetchBooks';\nimport saveStorageHandler from './localStorageHandler';\n\nconst axiosApi = new AxiosApi();\nconst LOCALSTORAGE_KEY = 'books';\nconst popupModal = document.createElement('div');\nconst chosenBook = document.querySelector('.js-all-books');\nlet bookInStorage = [];\nlet idBook = null;\n\nchosenBook.addEventListener('click', onClick);\n\nasync function onClick(e) {\n  const currentEl = e.target.parentElement;\n  if (!currentEl.classList.contains('js-book')) {\n    return;\n  }\n\n  idBook = e.target.parentElement.dataset.id;\n  let check = checkBookInStorage(idBook)\n    ? 'REMOVE FROM THE SHOPPING LIST'\n    : 'ADD TO SHOPPING LIST';\n  console.log(check);\n\n  try {\n    //Fetchs books from backend\n    const responce = await axiosApi.getShops(idBook);\n    const nodeEl = responce.data;\n\n    //Adds HTML render for modal window\n    popupModal.innerHTML = createPopupCard(nodeEl);\n    document.body.appendChild(popupModal);\n\n    //Button for adding books to bascket(cart)\n    const addHandler = popupModal.querySelector('.js-add-storage');\n    console.dir(addHandler);\n\n    addHandler.addEventListener('click', evt => {\n      addBookToShoppingList(idBook);\n\n      // console.log(idBook);\n    });\n\n    //Close modal window button\n    const btnPopupClose = popupModal.querySelector('.js-popup-close');\n    btnPopupClose.addEventListener('click', onClose);\n  } catch (error) {\n    console.log(error);\n  }\n}\n\n//Creates HTML render for modal window\nfunction createPopupCard({\n  author,\n  book_image,\n  title,\n  buy_links,\n  list_name,\n  description,\n}) {\n  return `<div class=\"popup-backdrop\">\n  <div class=\"js-popup popup__body\">\n  <div class=\"popup__container\">\n  <button  class=\"js-popup-close btn__close\" type=\"button\">\n        <svg width=\"16\" height=\"15\"></svg>\n        <use href=\"./images/sprite.svg#icon-x-close\"></use>\n        </svg>\n    </button>\n    <div class=\"popup-book\">\n    <div class=\"popup-book__thumb\">\n        <img class=\"popup-book__img\" src=\"${book_image}\" alt=\"${title}\">\n        </div>\n    <div class=\"popup-book__info\"\n        <h2>${title}</h2>\n        <h3>${author}</h3>\n        <p>${description}</p>\n        <ul class=\"modal__shops-link\">${createShopLinks(buy_links)}</ul>\n        </div>\n    </div>\n    <div>\n        <button type=\"button\" class=\"action-button js-add-storage\">add to shoping list</button>\n        <p class=\"popup__text\">text</p>\n    </div>\n    </div>\n    </div>\n    </div>`;\n}\n\n//Creates HTML render of shop links for modal window\nfunction createShopLinks(buyLinks) {\n  const filteredShops = buyLinks.filter(\n    ({ name }) =>\n      name === 'Amazon' || name === 'Apple Books' || name === 'Bookshop'\n  );\n\n  const markupShops = filteredShops\n    .map(\n      ({ name, url }) => `  <li>\n                <a href=\"${url}\" target=\"_blank\" rel=\"noopener noreferrer nofollow\">\n                    <img src=\"\" alt=\"${name}\">\n                </a>\n            </li>`\n    )\n    .join('');\n  return markupShops;\n}\n\n//Closes modal window, removes event listeners\nfunction onClose(evt) {\n  if (!evt.target) {\n    return;\n  } else {\n    document.body.removeChild(popupModal);\n    document.removeEventListener('keyup', onEscape);\n  }\n}\n\n//Adds book to shopping cart(bascket)\nfunction addBookToShoppingList(idBook) {\n  if (checkBookInStorage(idBook)) {\n    removeBookFromShopingList(idBook);\n    return;\n  }\n  bookInStorage.push(idBook);\n  localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(bookInStorage));\n  console.log(bookInStorage);\n}\n\n//Removes book from shopping cart(bascket)\nfunction removeBookFromShopingList(idBook) {\n  let arr = JSON.parse(localStorage.getItem(LOCALSTORAGE_KEY));\n  arr = arr.filter(item => item !== idBook);\n  localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(arr));\n}\n\n//Adds listener for Escape key\nconst onEscape = evt => {\n  if (evt.key === 'Escape') {\n    document.body.removeChild(popupModal);\n    document.removeEventListener('keyup', onEscape);\n  }\n};\ndocument.addEventListener('keydown', onEscape);\n\nfunction checkBookInStorage(idBook) {\n  bookInStorage = JSON.parse(localStorage.getItem(LOCALSTORAGE_KEY)) ?? [];\n  if (!bookInStorage.includes(idBook)) {\n    return false;\n  }\n  return true;\n}\n","import axios from 'axios';\n\nexport class AxiosApi {\n  #BASE_URL = 'https://books-backend.p.goit.global/books/';\n\n  async getShops(bookId) {\n    const url = `${this.#BASE_URL}${bookId}`;\n\n    const result = await axios.get(url);\n    return result;\n  }\n}\n"],"names":["$2OfAl","parcelRequire","$0ba687617202890c$var$axiosApi","AxiosApi","$0ba687617202890c$var$LOCALSTORAGE_KEY","$0ba687617202890c$var$popupModal","document","createElement","$0ba687617202890c$var$chosenBook","querySelector","$0ba687617202890c$var$bookInStorage","$0ba687617202890c$var$idBook","$0ba687617202890c$var$onClose","evt","target","body","removeChild","removeEventListener","$0ba687617202890c$var$onEscape","addEventListener","async","e","parentElement","classList","contains","dataset","id","check","$0ba687617202890c$var$checkBookInStorage","console","log","nodeEl","getShops","data","innerHTML","author","book_image","title","buy_links","list_name","description","buyLinks","filteredShops","filter","name","map","url","join","$0ba687617202890c$var$createShopLinks","$0ba687617202890c$var$createPopupCard","appendChild","addHandler","dir","idBook1","idBook2","arr","JSON","parse","localStorage","getItem","item","setItem","stringify","$0ba687617202890c$var$removeBookFromShopingList","push","$0ba687617202890c$var$addBookToShoppingList","error","key","idBook3","includes","$2shzp","$20bc572dfdce3226$export$166206578d5f52f9","BASE_URL","bookId","this","default","get"],"version":3,"file":"popupModal.256f73e9.js.map"}